<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Lab Assistant Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"> <!-- Font Awesome -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Add marked library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.3/purify.min.js"></script>
    <script src="{{ url_for('static', filename='js/feedback.js') }}"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            marked.setOptions({
                breaks: true, // This will render line breaks in Markdown
                gfm: true,    // GitHub Flavored Markdown
            });
            console.log('Marked library loaded:', typeof marked);
            console.log('Markdown test:', marked.parse('# Hello\n\nThis is a **test**.'));
        });
    </script>
</head>
<body>
    <!-- Include the navigation bar -->
    {% include 'navbar.html' %}

    <div class="container-fluid">
        <div class="row">
            {% if is_chat %}
            <!-- Chat interface -->
                <div class="col-md-12 main-content">
                    <div class="d-flex flex-column align-items-center mb-3">
                        <h5>Are you having trouble?</h5>
                        <div class="subheader">Consider some of these frequently asked questions</div>
                        <div class="sample-questions">
                            <div class="button-tile" onclick="handleSampleQuestion('Why can\'t my application connect to the MongoDB Cluster?')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="icon-md" style="color: rgb(226, 197, 65);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19a3 3 0 1 1-6 0M15.865 16A7.54 7.54 0 0 0 19.5 9.538C19.5 5.375 16.142 2 12 2S4.5 5.375 4.5 9.538A7.54 7.54 0 0 0 8.135 16m7.73 0h-7.73m7.73 0v3h-7.73v-3"></path>
                                </svg>
                                <div class="text">Can't connect?</div>
                            </div>
                            <div class="button-tile" onclick="handleSampleQuestion('Why is my library application displaying no data or books?')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="icon-md" style="color: rgb(118, 208, 235);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 19.5A2.5 2.5 0 006.5 22H20m-16-2.5V3.5A2.5 2.5 0 016.5 1H20a2.5 2.5 0 012.5 2.5v16.5m-18-2.5a2.5 2.5 0 012.5 2.5m-2.5-2.5H18M6.5 1v18M18 1v18M6.5 1H20M6.5 19.5H20" />
                                </svg>
                                <div class="text">No books displaying?</div>
                            </div>
                            <div class="button-tile" onclick="handleSampleQuestion('Why is my github codespace not responding or launching the application properly?')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="icon-md" style="color: rgb(203, 139, 208);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2a10 10 0 1 0 10 10h-2a8 8 0 1 1-8-8v2a6 6 0 1 0 6 6h2a10 10 0 1 0-10-10z" />
                                </svg>
                                <div class="text">Restart Codespaces?</div>
                            </div>
                            <div class="button-tile" onclick="handleSampleQuestion('What is Atlas Search?')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="icon-md" style="color: rgb(237, 98, 98);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a5 5 0 1 1-10 0 5 5 0 0 1 10 0z" />
                                </svg>
                                <div class="text">What is Atlas Search?</div>
                            </div>
                        </div>
                    </div>

                    <div class="chat-container-wrapper">
                        <div class="chat-container" id="chat-container"></div>
                        <div class="input-container">
                            <div class="input-group">
                                <input type="text" class="form-control" id="user-input" placeholder="Ask a question...">
                                <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
            <!-- Home page content -->
            <div class="col-md-12 main-content">
                <div class="home-page">
                    <h1>Welcome to the AI Lab Assistant</h1>
                    <p>
                        The AI Lab Assistant is designed to help you with commonly encountered issues while working on MongoDB projects. 
                        Whether you're having trouble connecting to your MongoDB cluster, displaying data in your application, or launching your GitHub codespace, 
                        the AI Lab Assistant is here to provide guidance and solutions.
                    </p>
                    <h3>Key Features:</h3>
                    <ul>
                        <li><strong>Real-time Assistance:</strong> Get immediate help with common MongoDB issues through our chat interface.</li>
                        <li><strong>Sample Questions:</strong> Quickly access solutions to frequently asked questions about MongoDB setup and troubleshooting.</li>
                        <li><strong>Admin Panel:</strong> Admins can manage questions and review unanswered queries to improve our knowledge base.</li>
                        <li><strong>Labs Access:</strong> Explore our developer labs to deepen your MongoDB knowledge and skills.</li>
                    </ul>
                    <h3>Get Involved</h3>
                    <p>We encourage you to fork the repository and review the code to gain a deeper understanding of how MongoDB VectorSearch can be implemented to build a similar system.</p>
                    <p>Check out, or <a href="https://github.com/mongodb-developer/ai_lab_assistant_chat/fork">fork</a> the project on GitHub: <a href="https://github.com/mongodb-developer/ai_lab_assistant_chat/">AI Lab Assistant Chat</a>.</p>
                    <p>By exploring the code and the design patterns used, you can learn how to create scalable and efficient applications using MongoDB. Happy coding!</p>
                    <p>
                        <a href="{{ url_for('main.chat') }}" class="btn btn-primary">Start a Conversation</a>
                    </p>
                    <div class="alert alert-info" role="alert">
                        <strong>Note Regarding This Software:</strong> This system is in beta testing and may have bugs. If you encounter any issues, please notify your instructor.
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <!-- Feedback section -->
    <div class="container mt-5" id="feedback-container">
        <button id="close-feedback" class="close-feedback-btn">&times;</button>
        <h2>We value your feedback!</h2>
        <p>Please rate your experience with our assistant:</p>
        <div id="feedback-scale" class="d-flex justify-content-center">
            <button class="feedback-button" data-value="1">üò°</button>
            <button class="feedback-button" data-value="2">üòü</button>
            <button class="feedback-button" data-value="3">üòê</button>
            <button class="feedback-button" data-value="4">üôÇ</button>
            <button class="feedback-button" data-value="5">üòç</button>
        </div>
        <p id="feedback-response" class="mt-3"></p>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/chat.js') }}" defer></script>
</body>
</html>
